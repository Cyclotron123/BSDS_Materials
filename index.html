<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BSDS_Materials ‚Äî Explorer</title>

  <!-- Dark blue theme (background + text). Toggle stored in localStorage. -->
  <style>
    :root{
      --bg-900: #021026; /* deep navy */
      --bg-800: #052241;
      --bg-700: #08304a;
      --accent: #4fc3f7; /* bright cyan for links/buttons */
      --muted: #9fb7cf;
      --card: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      --glass: rgba(255,255,255,0.02);
      --radius: 10px;
      --shadow: 0 6px 18px rgba(2,16,38,0.6);
      --mono: 'Segoe UI', Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--mono);
      background: radial-gradient(1200px 600px at 10% 10%, rgba(79,195,247,0.05), transparent),
                  linear-gradient(180deg,var(--bg-900), var(--bg-800));
      color: #dbeefb;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding: 28px;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 22px;
      align-items: start;
    }

    header {
      grid-column: 1 / -1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      margin-bottom: 6px;
    }

    header h1 {
      margin:0;
      font-size:20px;
      letter-spacing:0.2px;
      color: #e6f7ff;
    }

    .muted {
      color: var(--muted);
      font-size:13px;
    }

    .panel {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.02);
    }

    .repo-info {
      display:flex;
      gap:12px;
      align-items:center;
    }

    .controls { display:flex; gap:8px; align-items:center; }

    .btn {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.06);
      color: inherit;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-size:13px;
    }

    .btn.primary {
      background: linear-gradient(90deg, rgba(79,195,247,0.10), rgba(79,195,247,0.06));
      border-color: rgba(79,195,247,0.18);
      color: var(--accent);
      font-weight:600;
    }

    .list {
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .item {
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      padding:10px;
      border-radius:8px;
      transition:background .12s ease;
      cursor: pointer;
    }

    .item:hover { background: rgba(255,255,255,0.01); }

    .item .left { display:flex; gap:12px; align-items:center; }
    .item .name { font-weight:600; color:#e8f7ff; }
    .item .meta { color:var(--muted); font-size:13px; }

    .icon {
      width:36px;height:36px;border-radius:8px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,255,255,0.02);
      color:var(--accent); font-weight:700;
      font-size:16px;
    }

    .sidebar {
      position:relative;
    }

    .search {
      display:flex; gap:8px; margin-bottom:12px;
    }

    input[type="search"]{
      flex:1;
      padding:10px 12px;
      border-radius:10px;
      border: 1px solid rgba(255,255,255,0.03);
      background: rgba(255,255,255,0.01);
      color:inherit;
      outline:none;
    }

    .subpage {
      margin-top:12px;
    }

    .sub-list {
      margin-top:10px;
      padding-left:8px;
      border-left:1px dashed rgba(255,255,255,0.02);
    }

    a.file-link {
      color: var(--muted);
      font-size:13px;
      text-decoration:none;
    }

    .small { font-size:13px; color:var(--muted); }

    .toggle {
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
    }

    .hidden { display:none; }

    /* Responsive */
    @media (max-width:980px){
      .container { grid-template-columns: 1fr; padding: 12px; }
      .sidebar { order:2; }
    }

    /* Light-mode alternative (when theme toggled off) */
    body.light {
      --bg-900: #f7fafc;
      --bg-800: #f0f4f8;
      --bg-700: #e6eef6;
      --accent: #0b63b7;
      --muted: #374151;
      background: linear-gradient(180deg,#f7fbff,#eef6ff);
      color:#0b2b3a;
    }
    body.light .card-inv {
      background: rgba(11,99,183,0.04);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="repo-info">
        <h1>BSDS_Materials</h1>
        <div class="muted">Explorer for Cyclotron123/BSDS_Materials</div>
      </div>

      <div class="controls">
        <label class="toggle btn" id="themeToggle">Toggle Theme</label>
        <a class="btn primary" id="openOnGit" href="https://github.com/Cyclotron123/BSDS_Materials" target="_blank" rel="noreferrer">Open on GitHub</a>
      </div>
    </header>

    <!-- Main: folder list -->
    <main class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div><strong>Primary folders</strong></div>
        <div class="small" id="rootCount">loading‚Ä¶</div>
      </div>

      <div class="list" id="rootList">
        <!-- dynamically filled -->
      </div>

      <div class="muted" style="margin-top:12px;font-size:13px;">
        Click a folder to expand its subfolders and files on the right panel.
      </div>
    </main>

    <!-- Sidebar: details / subpages -->
    <aside class="sidebar panel">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <strong id="sideTitle">Details</strong>
        <div class="small" id="sidePath">/</div>
      </div>

      <div class="search">
        <input type="search" id="search" placeholder="Filter files and folders" />
        <button class="btn" id="collapseAll">Collapse</button>
      </div>

      <div id="sideContent" class="subpage">
        <div class="muted">Select a folder to view subfolders and files.</div>
      </div>
    </aside>
  </div>

  <script>
    // Configuration
    const owner = 'Cyclotron123';
    const repo = 'BSDS_Materials';
    const branch = 'main';

    // Utility to build GitHub API URL for a path
    function apiUrl(path) {
      const p = path ? encodeURIComponent(path) : '';
      return `https://api.github.com/repos/${owner}/${repo}/contents/${p}?ref=${branch}`;
    }

    // Theme handling
    (function(){
      const themeKey = 'bsds_theme_dark';
      const t = localStorage.getItem(themeKey);
      if(t === null || t === 'true') {
        document.body.classList.remove('light');
        localStorage.setItem(themeKey, 'true');
      } else {
        document.body.classList.add('light');
      }
      const toggle = document.getElementById('themeToggle');
      toggle.addEventListener('click', ()=>{
        const isDark = localStorage.getItem(themeKey) === 'true';
        localStorage.setItem(themeKey, (!isDark).toString());
        document.body.classList.toggle('light', isDark);
      });
    })();

    // DOM refs
    const rootList = document.getElementById('rootList');
    const rootCount = document.getElementById('rootCount');
    const sideTitle = document.getElementById('sideTitle');
    const sidePath = document.getElementById('sidePath');
    const sideContent = document.getElementById('sideContent');
    const search = document.getElementById('search');
    const collapseAll = document.getElementById('collapseAll');

    // fetch contents of a path from GitHub API
    async function fetchContents(path = '') {
      const url = apiUrl(path);
      const res = await fetch(url, { headers:{ Accept: 'application/vnd.github.v3+json' }});
      if(!res.ok) throw new Error('Failed to load repository contents: ' + res.status);
      return res.json();
    }

    // Render root folders (primary folders only: directories at repository root)
    async function loadRoot() {
      rootList.innerHTML = 'loading‚Ä¶';
      try {
        const contents = await fetchContents('');
        const dirs = contents.filter(c => c.type === 'dir');
        rootList.innerHTML = '';
        rootCount.textContent = dirs.length + ' folders';
        if(dirs.length === 0){
          rootList.innerHTML = '<div class="muted">No folders found in repository root.</div>';
          return;
        }
        for(const d of dirs){
          const item = document.createElement('div');
          item.className = 'item';
          item.dataset.path = d.path;
          item.innerHTML = `
            <div class="left">
              <div class="icon">üìÅ</div>
              <div>
                <div class="name">${escapeHtml(d.name)}</div>
                <div class="meta">directory</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn" data-action="open">Open</button>
            </div>
          `;
          item.querySelector('button[data-action="open"]').addEventListener('click', (e)=>{
            e.stopPropagation();
            openFolder(d.path);
          });
          item.addEventListener('click', ()=> openFolder(d.path));
          rootList.appendChild(item);
        }
      } catch(err){
        rootList.innerHTML = '<div class="muted">Unable to load repository contents.</div>';
        console.error(err);
      }
    }

    // Escape simple HTML
    function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    // Open folder and show subfolders + files in sidebar, with expandable subpages
    async function openFolder(path) {
      sideTitle.textContent = path.split('/').slice(-1)[0] || '/';
      sidePath.textContent = '/' + path;
      sideContent.innerHTML = '<div class="muted">loading‚Ä¶</div>';
      try {
        const items = await fetchContents(path);
        // sort directories first, then files
        items.sort((a,b)=>{
          if(a.type === b.type) return a.name.localeCompare(b.name);
          return a.type === 'dir' ? -1 : 1;
        });

        // build interactive list
        const frag = document.createDocumentFragment();
        const ul = document.createElement('div');
        ul.className = 'sub-list';
        for(const it of items){
          const row = document.createElement('div');
          row.className = 'item';
          row.style.cursor = 'default';
          const left = document.createElement('div');
          left.className = 'left';
          const icon = document.createElement('div');
          icon.className = 'icon';
          icon.textContent = it.type === 'dir' ? 'üìÅ' : 'üìÑ';
          const nameWrap = document.createElement('div');
          const name = document.createElement('div');
          name.className = 'name';
          name.innerHTML = escapeHtml(it.name);
          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.textContent = it.type === 'dir' ? 'directory' : it.size ? formatBytes(it.size) : '';
          nameWrap.appendChild(name);
          nameWrap.appendChild(meta);
          left.appendChild(icon);
          left.appendChild(nameWrap);
          row.appendChild(left);

          const right = document.createElement('div');
          right.style.display = 'flex';
          right.style.gap = '8px';

          if(it.type === 'dir'){
            const toggle = document.createElement('button');
            toggle.className = 'btn';
            toggle.textContent = 'Expand';
            toggle.addEventListener('click', async ()=>{
              if(toggle.dataset.open === '1'){
                // collapse
                const sub = row.nextElementSibling;
                if(sub && sub.classList.contains('sub-list')) sub.remove();
                toggle.dataset.open = '0';
                toggle.textContent = 'Expand';
              } else {
                toggle.disabled = true;
                toggle.textContent = 'Loading‚Ä¶';
                try {
                  const subItems = await fetchContents(it.path);
                  const container = document.createElement('div');
                  container.className = 'sub-list';
                  for(const s of subItems.sort((a,b)=> a.type === b.type ? a.name.localeCompare(b.name) : (a.type === 'dir' ? -1:1))){
                    const subRow = document.createElement('div');
                    subRow.className = 'item';
                    subRow.style.padding = '8px';
                    subRow.style.cursor = 'default';
                    subRow.innerHTML = `
                      <div class="left" style="gap:10px;">
                        <div class="icon">${s.type==='dir'?'üìÅ':'üìÑ'}</div>
                        <div>
                          <div class="name">${escapeHtml(s.name)}</div>
                          <div class="meta">${s.type}</div>
                        </div>
                      </div>
                      <div style="display:flex;gap:8px;align-items:center;">
                        ${s.type === 'file' ? `<a class="btn" href="${s.html_url}" target="_blank" rel="noreferrer">View</a>` : `<button class="btn">Open</button>`}
                      </div>
                    `;
                    if(s.type === 'dir'){
                      subRow.querySelector('button').addEventListener('click', ()=> openFolder(s.path));
                    }
                    container.appendChild(subRow);
                  }
                  row.insertAdjacentElement('afterend', container);
                  toggle.dataset.open = '1';
                  toggle.textContent = 'Collapse';
                } catch(e){
                  console.error(e);
                  toggle.textContent = 'Error';
                } finally {
                  toggle.disabled = false;
                }
              }
            });
            right.appendChild(toggle);
          } else {
            const view = document.createElement('a');
            view.className = 'btn';
            view.href = it.html_url;
            view.target = '_blank';
            view.rel = 'noreferrer';
            view.textContent = 'Open';
            right.appendChild(view);
          }

          row.appendChild(right);
          ul.appendChild(row);
        }

        frag.appendChild(ul);
        // replace side content
        sideContent.innerHTML = '';
        sideContent.appendChild(frag);
      } catch(err){
        sideContent.innerHTML = '<div class="muted">Unable to load folder contents.</div>';
        console.error(err);
      }
    }

    // format bytes
    function formatBytes(bytes){
      if(bytes === 0) return '0 B';
      const k = 1024, sizes = ['B','KB','MB','GB'];
      const i = Math.floor(Math.log(bytes)/Math.log(k));
      return parseFloat((bytes/Math.pow(k,i)).toFixed(2)) + ' ' + sizes[i];
    }

    // search/filter functionality
    search.addEventListener('input', ()=>{
      const q = search.value.trim().toLowerCase();
      const rows = sideContent.querySelectorAll('.item, .sub-list .item');
      rows.forEach(r=>{
        const name = r.querySelector('.name')?.textContent?.toLowerCase() || '';
        r.style.display = name.includes(q) ? '' : 'none';
      });
    });

    collapseAll.addEventListener('click', ()=>{
      // remove any sub-lists inside sideContent
      const subs = sideContent.querySelectorAll('.sub-list');
      subs.forEach((s, i)=>{
        // keep the top-level container, collapse nested ones (those with parent .item preceding them)
        if(s.parentElement !== sideContent) s.remove();
        else {
          // if top-level, collapse children inside it (but keep the top-level container)
          const toggles = sideContent.querySelectorAll('button[data-open="1"]');
          toggles.forEach(t=>{
            t.dataset.open = '0';
            t.textContent = 'Expand';
            const next = t.closest('.item')?.nextElementSibling;
            if(next && next.classList.contains('sub-list')) next.remove();
          });
        }
      });
    });

    // initial load
    loadRoot();

    // expose openFolder to URL hash navigation (optional)
    window.addEventListener('hashchange', ()=>{
      const p = location.hash.replace(/^#/, '');
      if(p) openFolder(decodeURIComponent(p));
    });
    // if hash present on load
    if(location.hash) {
      const p = location.hash.replace(/^#/, '');
      if(p) openFolder(decodeURIComponent(p));
    }
  </script>
</body>
</html>
