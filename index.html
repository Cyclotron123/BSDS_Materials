<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BSDS Materials ‚Äî Browser</title>

  <!--
    Single-file GitHub Pages browser for a repository.

    How to change repository:
      - Edit the OWNER, REPO, and BRANCH constants in the <script> section near the bottom.

    How it works:
      - Uses GitHub Contents API to list directories and files.
      - Top-level view shows only top-level folders (per user request).
      - Click (or keyboard-activate) folders to "open" them as subpages by updating the location hash.
      - Breadcrumbs reflect current path and let you navigate up.
      - Text files are previewed inline (fetched from the API and shown as decoded UTF-8).
      - PDFs are opened in an in-browser viewer using raw.githubusercontent.com URLs.
      - Other files provide a "Download / Open raw" link to raw.githubusercontent.com.

    How to deploy to GitHub Pages:
      - Save this file as index.html at the root of the repository you want to host (or any branch you choose).
      - In the repository's Settings -> Pages, set the source to the branch where index.html is located (e.g., main) and the root folder.
      - Wait a minute and visit https://<your-username>.github.io/<repo-name>/ (or the Pages URL shown).
  -->

  <style>
    :root{
      --bg: #041022; /* deep navy dark-blue background */
      --panel: #082438;
      --muted: #9fb3c8;
      --accent: #3fb0ff;
      --white: #ffffff;
      --radius: 10px;
      --gap: 14px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#02121a);color:var(--white);}
    .app{
      max-width:1100px;margin:32px auto;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;box-shadow: 0 6px 30px rgba(0,0,0,0.6);min-height:60vh;
    }

    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{
      width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#2b8bd6);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--bg);font-size:20px;
      box-shadow:0 4px 18px rgba(59,113,173,0.18);
      flex:0 0 56px;
    }
    h1{font-size:20px;margin:0}
    .sub{color:var(--muted);font-size:13px;margin-top:4px}

    main{display:grid;grid-template-columns: 320px 1fr;gap:20px}
    @media (max-width:880px){ main{grid-template-columns: 1fr;}}
    nav.panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);min-height:300px;
    }
    .panel h2{font-size:14px;margin:0 0 10px 0;color:var(--muted)}
    .list{display:flex;flex-direction:column;gap:10px}
    .folder{
      display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;cursor:pointer;
      background:transparent;border:1px solid transparent;outline:none;
      color:var(--white);font-weight:600;
    }
    .folder:focus, .folder:hover{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.03)}
    .folder .icon{width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;color:var(--accent);font-weight:700}
    .meta{font-size:12px;color:var(--muted);font-weight:500}

    section.viewer{
      padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      min-height:300px;display:flex;flex-direction:column;
    }
    .crumbs{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .crumb{font-size:13px;color:var(--muted);cursor:pointer;user-select:none}
    .crumb.curr{color:var(--white);font-weight:700}
    .viewer-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .viewer-title{font-size:16px;font-weight:700}
    .viewer-tools{display:flex;gap:8px;align-items:center}
    .btn{
      background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--white);cursor:pointer;font-weight:600;
    }
    .btn:focus{outline:3px solid rgba(63,176,255,0.12)}
    .content{overflow:auto;background:rgba(0,0,0,0.15);padding:14px;border-radius:10px;color:var(--white);flex:1;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;font-size:13px;line-height:1.5}
    .placeholder{color:var(--muted);padding:18px;border-radius:8px}
    .file-row{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px;border-radius:8px}
    .file-row:hover{background:rgba(255,255,255,0.02)}
    .file-left{display:flex;align-items:center;gap:12px}
    .file-icon{width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;color:var(--accent);font-weight:700}
    .file-name{font-weight:700}
    .small{font-size:12px;color:var(--muted)}

    /* accessible focus outline for keyboard users */
    :focus{outline:none}
    .a11y-focus:focus{box-shadow:0 0 0 4px rgba(63,176,255,0.12);border-radius:8px}

    footer{margin-top:16px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    a.link{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Repository file browser">
    <header>
      <div class="logo" aria-hidden="true">BS</div>
      <div>
        <h1>BSDS_Materials ‚Äî Browser</h1>
        <div class="sub" id="repoDesc">Repository view powered by GitHub Contents API</div>
      </div>
    </header>

    <main>
      <nav class="panel" aria-label="Top-level folders">
        <h2>Top-level Folders</h2>
        <div class="list" id="foldersList" role="list" tabindex="0" aria-label="Repository folders">
          <!-- Top-level folders inserted here -->
        </div>

        <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="refreshBtn" class="btn a11y-focus" title="Refresh (r)">Refresh</button>
          <button id="homeBtn" class="btn a11y-focus" title="Home (g then h)">Home</button>
          <div style="flex:1"></div>
          <div class="small" id="rateNote">Public GitHub API used; unauthenticated rate limits apply</div>
        </div>
      </nav>

      <section class="viewer" id="viewer" aria-live="polite">
        <div class="crumbs" id="breadcrumbs" aria-label="Breadcrumbs">
          <!-- breadcrumbs here -->
        </div>

        <div class="viewer-header">
          <div class="viewer-title" id="viewerTitle">Top-level Folders</div>
          <div class="viewer-tools">
            <button id="toggleListView" class="btn a11y-focus" title="Toggle list/grid view">Toggle view</button>
            <a id="rawOpen" class="btn link" style="display:none" target="_blank" rel="noopener">Open raw</a>
            <a id="downloadLink" class="btn link" style="display:none" target="_blank" rel="noopener">Download</a>
          </div>
        </div>

        <div id="viewerBody" class="content" tabindex="0">
          <div class="placeholder" id="placeholder">Select a folder on the left to view its contents. Use keyboard: Tab to focus folders, Enter or Space to open.</div>
        </div>
      </section>
    </main>

    <footer>
      <div>Owner: <strong id="ownerName">Cyclotron123</strong> ¬∑ Repo: <strong id="repoName">BSDS_Materials</strong> ¬∑ Branch: <strong id="branchName">main</strong></div>
      <div>Accessible keyboard toggles: Tab, Enter/Space to open, g then h to go home, r to refresh</div>
    </footer>
  </div>

  <script>
    // ======= CONFIGURATION =======
    // Change these constants to point the browser at a different repository/branch.
    const OWNER = 'Cyclotron123'; // <-- change owner here
    const REPO = 'BSDS_Materials'; // <-- change repo here
    const BRANCH = 'main';         // <-- change branch here
    // =============================

    // Derived DOM elements
    const foldersList = document.getElementById('foldersList');
    const viewerBody = document.getElementById('viewerBody');
    const viewerTitle = document.getElementById('viewerTitle');
    const breadcrumbs = document.getElementById('breadcrumbs');
    const placeholder = document.getElementById('placeholder');
    const repoDesc = document.getElementById('repoDesc');
    const ownerName = document.getElementById('ownerName');
    const repoName = document.getElementById('repoName');
    const branchName = document.getElementById('branchName');
    const refreshBtn = document.getElementById('refreshBtn');
    const homeBtn = document.getElementById('homeBtn');
    const rawOpen = document.getElementById('rawOpen');
    const downloadLink = document.getElementById('downloadLink');
    const toggleListView = document.getElementById('toggleListView');
    const rateNote = document.getElementById('rateNote');

    ownerName.textContent = OWNER;
    repoName.textContent = REPO;
    branchName.textContent = BRANCH;

    // Accessibility: track last key for shortcuts like "g then h"
    let lastKey = null;
    window.addEventListener('keydown', (e) => {
      // simple single-key shortcuts
      if (e.key === 'r' || e.key === 'R') { e.preventDefault(); loadTopLevel(); return; }
      if ((e.key === 'g' || e.key === 'G')) { lastKey = 'g'; setTimeout(()=> lastKey = null, 800); return; }
      if (lastKey === 'g' && (e.key === 'h' || e.key === 'H')) { e.preventDefault(); goHome(); lastKey = null; return; }
      // navigate with enter/space handled on focused elements
    });

    // Keyboard activation for clickable elements: space and enter will trigger click
    document.addEventListener('keydown', (e) => {
      if ((e.key === 'Enter' || e.key === ' ') && document.activeElement && document.activeElement.classList.contains('focus-click')) {
        e.preventDefault();
        document.activeElement.click();
      }
    });

    // Utility: GitHub API endpoints
    function contentsApiPath(path){
      // path: folder or file path relative to repo root, empty string for root
      return `https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}?ref=${encodeURIComponent(BRANCH)}`;
    }
    function rawUrl(path){
      return `https://raw.githubusercontent.com/${OWNER}/${REPO}/${encodeURIComponent(BRANCH)}/${path}`;
    }

    // Fetch and list top-level entries, but show only top-level folders on the main page per request.
    async function loadTopLevel(){
      setLoadingState(true, 'Loading top-level folders...');
      clearViewer();
      try{
        const res = await fetch(contentsApiPath(''));
        if (!res.ok) throw new Error('Failed to fetch repository contents. ' + res.statusText);
        const entries = await res.json();
        // entries is an array of objects with {name, path, type, ...}
        // Filter to directories only for the main page
        const folders = entries.filter(e => e.type === 'dir').sort((a,b)=>a.name.localeCompare(b.name, undefined, {sensitivity:'base'}));
        renderFolders(folders);
        repoDesc.textContent = `Browsing ${OWNER}/${REPO}@${BRANCH}.`;
      }catch(err){
        console.error(err);
        foldersList.innerHTML = `<div class="small" style="color:var(--muted)">Unable to load repository contents: ${escapeHtml(err.message)}</div>`;
      } finally {
        setLoadingState(false);
      }
    }

    // Render folder list in the left panel
    function renderFolders(folders){
      foldersList.innerHTML = '';
      if (!folders.length){
        foldersList.innerHTML = `<div class="small" style="color:var(--muted)">No top-level folders found in this repository.</div>`;
        return;
      }
      folders.forEach(folder=>{
        const btn = document.createElement('button');
        btn.setAttribute('role','listitem');
        btn.className = 'folder focus-click a11y-focus';
        btn.title = 'Open folder ' + folder.name;
        btn.tabIndex = 0;
        btn.innerHTML = `
          <div class="icon" aria-hidden="true">üìÅ</div>
          <div style="display:flex;flex-direction:column;align-items:flex-start;text-align:left">
            <div style="font-weight:700">${escapeHtml(folder.name)}</div>
            <div class="meta">Folder</div>
          </div>
        `;
        btn.addEventListener('click', ()=> openPath(folder.path));
        // support keyboard focus visuals
        btn.addEventListener('focus', ()=> btn.classList.add('focused'));
        btn.addEventListener('blur', ()=> btn.classList.remove('focused'));
        foldersList.appendChild(btn);
      });
    }

    // Open a path (folder). Uses URL hash to create subpages and allow navigation/back.
    // Example: #/path/to/folder
    function openPath(path){
      // Update hash, this triggers onhashchange handler
      location.hash = '#/' + encodeURIComponent(path);
    }

    // Hash parsing and navigation
    window.addEventListener('hashchange', handleHashChange);
    async function handleHashChange(){
      const hash = decodeURIComponent(location.hash || '');
      if (!hash || hash === '') { // go to top-level view
        clearViewer();
        viewerTitle.textContent = 'Top-level Folders';
        breadcrumbs.innerHTML = '';
        placeholder.style.display = 'block';
        placeholder.textContent = 'Select a folder on the left to view its contents. Use keyboard: Tab to focus folders, Enter or Space to open.';
        rawOpen.style.display = 'none';
        downloadLink.style.display = 'none';
        return;
      }
      if (!hash.startsWith('#/')) return;
      const path = hash.slice(2);
      await showDirectory(path);
    }

    // Show directory contents for a given path
    async function showDirectory(path){
      setLoadingState(true, 'Loading ' + path + ' ...');
      try{
        const res = await fetch(contentsApiPath(path));
        if (!res.ok) throw new Error('Failed to load folder: ' + res.statusText);
        const entries = await res.json();
        // entries may be an array for a folder, or a single object for a file
        if (!Array.isArray(entries)){
          // It's a file; open file view instead
          return showFile(entries.path);
        }
        // Show breadcrumbs
        renderBreadcrumbs(path);
        viewerTitle.textContent = path.split('/').slice(-1)[0] || path;
        rawOpen.style.display = 'none';
        downloadLink.style.display = 'none';
        // Render folder contents: folders first, then files
        const dirs = entries.filter(e=>e.type === 'dir').sort((a,b)=>a.name.localeCompare(b.name,undefined,{sensitivity:'base'}));
        const files = entries.filter(e=>e.type === 'file').sort((a,b)=>a.name.localeCompare(b.name,undefined,{sensitivity:'base'}));
        renderDirectoryList(path, dirs, files);
      }catch(err){
        console.error(err);
        viewerBody.innerHTML = `<div class="placeholder">Unable to load folder: ${escapeHtml(err.message)}</div>`;
      } finally {
        setLoadingState(false);
      }
    }

    function renderBreadcrumbs(path){
      breadcrumbs.innerHTML = '';
      const parts = path.split('/').filter(Boolean);
      // Home crumb
      const homeCrumb = document.createElement('div');
      homeCrumb.className = 'crumb';
      homeCrumb.textContent = 'Home';
      homeCrumb.tabIndex = 0;
      homeCrumb.addEventListener('click', ()=> { location.hash = ''; });
      breadcrumbs.appendChild(homeCrumb);

      let accum = '';
      parts.forEach((p,i)=>{
        accum += (i ? '/' : '') + p;
        const c = document.createElement('div');
        c.className = 'crumb' + (i === parts.length-1 ? ' curr' : '');
        c.textContent = p;
        c.tabIndex = 0;
        c.addEventListener('click', ()=> { location.hash = '#/' + encodeURIComponent(accum); });
        breadcrumbs.appendChild(createSep());
        breadcrumbs.appendChild(c);
      });

      function createSep(){ const s=document.createElement('div'); s.textContent='‚Ä∫'; s.className='small'; s.style.margin='0 6px'; return s; }
    }

    function renderDirectoryList(currentPath, dirs, files){
      if (!dirs.length && !files.length){
        viewerBody.innerHTML = `<div class="placeholder">This folder is empty.</div>`;
        return;
      }
      const container = document.createElement('div');
      container.style.display = 'flex';
      container.style.flexDirection = 'column';
      container.style.gap = '6px';

      // Directories
      if (dirs.length){
        const hdr = document.createElement('div');
        hdr.className = 'small'; hdr.textContent = 'Folders';
        container.appendChild(hdr);
        dirs.forEach(d=>{
          const row = document.createElement('div');
          row.className = 'file-row focus-click a11y-focus';
          row.tabIndex = 0;
          row.innerHTML = `
            <div class="file-left">
              <div class="file-icon">üìÅ</div>
              <div>
                <div class="file-name">${escapeHtml(d.name)}</div>
                <div class="small">Folder</div>
              </div>
            </div>
            <div class="small">Open</div>
          `;
          row.addEventListener('click', ()=> openPath(d.path));
          container.appendChild(row);
        });
      }

      // Files
      if (files.length){
        const hdr = document.createElement('div');
        hdr.className = 'small'; hdr.textContent = 'Files';
        hdr.style.marginTop = '10px';
        container.appendChild(hdr);
        files.forEach(f=>{
          const row = document.createElement('div');
          row.className = 'file-row focus-click a11y-focus';
          row.tabIndex = 0;
          row.innerHTML = `
            <div class="file-left">
              <div class="file-icon">üìÑ</div>
              <div>
                <div class="file-name">${escapeHtml(f.name)}</div>
                <div class="small">${escapeHtml(f.size ? humanFileSize(f.size) : '')}</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn open-file a11y-focus" title="Preview/Open ${escapeHtml(f.name)}">Open</button>
            </div>
          `;
          row.querySelector('.open-file').addEventListener('click', ()=> showFile(f.path));
          container.appendChild(row);
        });
      }

      viewerBody.innerHTML = '';
      viewerBody.appendChild(container);
    }

    // Show a file: preview text files inline, open PDFs in embedded viewer, otherwise provide raw link
    async function showFile(path){
      setLoadingState(true, 'Loading file ' + path + ' ...');
      try{
        // Fetch file metadata and content via Contents API
        const res = await fetch(contentsApiPath(path));
        if (!res.ok) throw new Error('Failed to load file: ' + res.statusText);
        const meta = await res.json();
        // meta contains 'encoding' and 'content' for files
        renderBreadcrumbs(path.split('/').slice(0,-1).join('/'));
        viewerTitle.textContent = meta.name;
        const ext = meta.name.split('.').pop().toLowerCase();

        // Provide raw and download links
        const raw = rawUrl(path);
        rawOpen.href = raw;
        rawOpen.style.display = 'inline-block';
        rawOpen.textContent = 'Open raw';
        downloadLink.href = raw;
        downloadLink.style.display = 'inline-block';
        downloadLink.textContent = 'Download';

        // Text file preview heuristics
        if (isTextFile(ext, meta)){
          // decode base64 content reported by the API
          const text = decodeContent(meta);
          viewerBody.innerHTML = '';
          const pre = document.createElement('pre');
          pre.style.whiteSpace = 'pre-wrap';
          pre.style.wordBreak = 'break-word';
          pre.textContent = text;
          viewerBody.appendChild(pre);
          return;
        }

        // PDF in-browser viewing
        if (ext === 'pdf'){
          viewerBody.innerHTML = '';
          const embed = document.createElement('iframe');
          embed.src = raw;
          embed.style.width = '100%';
          embed.style.height = '70vh';
          embed.style.border = 'none';
          embed.title = meta.name;
          viewerBody.appendChild(embed);
          return;
        }

        // Image files can be previewed in an <img>
        if (['png','jpg','jpeg','gif','webp','svg'].includes(ext)){
          viewerBody.innerHTML = '';
          const img = document.createElement('img');
          img.src = raw;
          img.alt = meta.name;
          img.style.maxWidth = '100%';
          img.style.borderRadius = '8px';
          img.style.display = 'block';
          viewerBody.appendChild(img);
          return;
        }

        // For binary or unknown types, show metadata and raw link
        viewerBody.innerHTML = `<div class="placeholder">No preview available for this file type. Use "Open raw" or "Download" to get the file.</div>`;
      }catch(err){
        console.error(err);
        viewerBody.innerHTML = `<div class="placeholder">Unable to load file: ${escapeHtml(err.message)}</div>`;
      } finally {
        setLoadingState(false);
      }
    }

    // Small helper: determine if the file is plain text (by extension and content size)
    function isTextFile(ext, meta){
      const textExts = ['md','txt','json','yaml','yml','py','js','ts','html','css','csv','log','ini','cfg','tex','rst'];
      if (textExts.includes(ext)) return true;
      // fallback heuristic: content encoding present and size not huge
      return (meta.encoding === 'base64' && (meta.size === undefined || meta.size < 200000));
    }

    // decode base64 content from GitHub API safely into UTF-8 string
    function decodeContent(meta){
      try{
        const b64 = meta.content.replace(/\n/g,'');
        // atob may throw on large strings; use Uint8Array approach for utf-8
        const binary = atob(b64);
        // convert binary string to bytes
        const bytes = new Uint8Array(binary.length);
        for (let i=0;i<binary.length;i++) bytes[i]=binary.charCodeAt(i);
        // decode UTF-8
        const decoder = new TextDecoder('utf-8', {fatal:false});
        return decoder.decode(bytes);
      }catch(e){
        console.warn('decode failed', e);
        return '[Unable to decode file content as UTF-8]';
      }
    }

    // Clear viewer to initial state
    function clearViewer(){
      viewerBody.innerHTML = '';
      placeholder.style.display = 'block';
      rawOpen.style.display = 'none';
      downloadLink.style.display = 'none';
      breadcrumbs.innerHTML = '';
      viewerTitle.textContent = 'Top-level Folders';
    }

    // small UI utilities
    function setLoadingState(isLoading, label){
      if (isLoading){
        placeholder.style.display = 'block';
        placeholder.textContent = label || 'Loading...';
        viewerBody.style.opacity = '0.9';
      } else {
        // clear placeholder only if content has been replaced
        if (viewerBody && viewerBody.children.length > 0){
          placeholder.style.display = 'none';
        } else {
          placeholder.style.display = 'block';
        }
        viewerBody.style.opacity = '1';
      }
    }

    function humanFileSize(size){
      if (!size) return '';
      const i = Math.floor(Math.log(size) / Math.log(1024));
      return (size / Math.pow(1024, i)).toFixed(1) * 1 + ' ' + ['B','kB','MB','GB','TB'][i];
    }

    function escapeHtml(s){ if (!s) return ''; return s.replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }

    // Toggle list view (example behavior: toggles monospace -> normal and compacting)
    let compact = false;
    toggleListView.addEventListener('click', ()=>{
      compact = !compact;
      if (compact){
        viewerBody.style.fontFamily = 'system-ui, sans-serif';
        viewerBody.style.fontSize = '14px';
      } else {
        viewerBody.style.fontFamily = 'ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace';
        viewerBody.style.fontSize = '13px';
      }
    });

    // Refresh and home buttons
    refreshBtn.addEventListener('click', ()=> loadTopLevel());
    homeBtn.addEventListener('click', ()=> goHome());
    function goHome(){ location.hash = ''; clearViewer(); }

    // Initialize: load top-level folders and respect existing hash
    (function init(){
      // If there's a hash, attempt to open it; otherwise load top-level folders.
      if (location.hash && location.hash.startsWith('#/')){
        handleHashChange().catch(()=>loadTopLevel());
      } else {
        loadTopLevel();
      }
      // show rate limit note for unauthenticated access
      detectRateLimit();
    })();

    // Try to fetch rate limit info to display friendly note (best-effort, no auth)
    async function detectRateLimit(){
      try{
        const r = await fetch('https://api.github.com/rate_limit');
        if (!r.ok) return;
        const j = await r.json();
        if (j && j.rate){
          rateNote.textContent = `API rate: ${j.rate.remaining}/${j.rate.limit} resets ${new Date(j.rate.reset*1000).toLocaleTimeString()}`;
        }
      }catch(e){}
    }

    // Small enhancement: make left-panel list container keyboard-scrollable
    foldersList.addEventListener('keydown', (e)=>{
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        const items = Array.from(foldersList.querySelectorAll('.folder'));
        if (!items.length) return;
        const idx = items.indexOf(document.activeElement);
        let next = 0;
        if (e.key === 'ArrowDown') next = Math.min(items.length-1, (idx === -1 ? -1 : idx) + 1);
        if (e.key === 'ArrowUp') next = Math.max(0, (idx === -1 ? items.length : idx) - 1);
        items[next].focus();
      }
    });

    // Ensure hash changes when opening a folder by clicking the desktop folder button
    // (Handled by openPath above)

    // End of script
  </script>
</body>
</html>
```
